/*
//testy
async function* get_from_file(filename) {
  let fs = require('fs');
  let filecontents;
  try {
    filecontents = fs.readFileSync(filename, 'utf8')
  } catch (err) {
    console.error(err);
  }
  let data = JSON.parse(filecontents);

  for(let datum of data) {
    yield datum;
  }
}


let test = require('tape');
let geojsonhint = require('geojsonhint');

test('main gives valid geojson', async function (t) {
  let area_id = 357;
  let geojson = await main(area_id);
  let errors = geojsonhint.hint(geojson);
  t.equal(errors.toString(), "");
  t.end();
});

/*

test('class Query gives well formed queries', function (t) {
  let expected_query = "SELECT ST_AsGeoJSON(geom), name, type FROM points_of_interest WHERE area_id=$1;";
  let query_object = new Query(
    'points_of_interest',
    ['name', 'type'],
    'area_id=$1',
  );
  t.equal(query_object.to_query(), expected_query);
  t.end();
});

test('can connect to database', function (t) {
  let queries = ["SELECT NOW() as now"];
  for (row of get_from_database(queries))  {
    let result = get_from_database(queries);
    t.ok(result);
    t.end();
    break;
  }
});


test('test data for points of intereset gives valid geojson', function (t) {
  function* t_to_o(test_points) {
    for (t of test_points) {
      yield {
        geom: t[0],
        name: t[1],
        type: t[2],
      }
    }
  }

  let test_points = [
    [
      {"type":"Point","coordinates":[-114.931216207695,49.3096484265684]},
      "Parking",
      "Parking",
    ],
    [
      {"type":"Point",
       "coordinates":[-114.753594914178,49.1604930993752]},
      "Cabin",
      "Cabin",
    ],
    [
      {"type":"Point","coordinates":[-114.646005244746,49.1704213207037]},
      "Hunger Lake",
      "Destination",
    ],
    [
      {"type":"Point","coordinates":[-114.7369057841,49.1297314898215]},
      "Cabin Pass",
      "Destination",
    ],
  ];

  geojson = collect_features(
    object_to_feature(
      t_to_o(
        test_points
      )
    )
  );

  let errors = geojsonhint.hint(geojson);
  t.equal(errors.toString(), "");
  t.end();
});


/*
  function test_av_paths() {
    function* geomify(rows) {
      for (let row of rows) {
        row.geom = row.st_asgeojson;
        yield row;
      }
    }

    let test_paths = [
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.828904049748,49.2273460600083],[-114.831953426696,49.2267660850021],[-114.833822335705,49.2262817787908],[-114.835598102774,49.2254127925644],[-114.837262614623,49.2238780230575],[-114.838581220198,49.2225207928407],[-114.839698012062,49.2211309221058],[-114.840323661988,49.2196180990786],[-114.841028114823,49.2170757264158],[-114.841156203398,49.2165981063849],[-114.841372516944,49.2149712382448],[-114.841595372031,49.2128470465943],[-114.841613994056,49.2116013280296],[-114.841614641469,49.2115581150316],[-114.841611616854,49.2109508234246]]}","name":"Path 23.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.805981523551,49.1541804551662],[-114.804410866686,49.1553383356645],[-114.801319489032,49.1576121019507],[-114.800642626123,49.1581909713147],[-114.799528053448,49.1591441403222],[-114.798980859802,49.1596120679155],[-114.795523653696,49.1623778006898]]}","name":"Path 1.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.79419116456,49.1514125341149],[-114.793061225294,49.1518459546235],[-114.791793876476,49.1524547821809],[-114.791263150419,49.152752066622],[-114.790660174249,49.1532833801702],[-114.789656108918,49.1539179997279],[-114.789396646812,49.1540819882529],[-114.787892422891,49.1551998545442],[-114.787859450362,49.1552273400761],[-114.785633317761,49.1570830790412]]}","name":"Path 2.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.775982035175,49.135955855523],[-114.774119159206,49.1364920145654],[-114.772681551694,49.1369385750571],[-114.771991685649,49.1371528640546],[-114.769553776184,49.1378463274343],[-114.766273303041,49.1388004327842],[-114.765612798606,49.1389925241592],[-114.760074253661,49.1401494045698]]}","name":"Path 3.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.76229938602,49.1311517234629],[-114.75833716423,49.1336095384082],[-114.75596766022,49.1350791769856],[-114.755430590821,49.1354297521242],[-114.753434262793,49.1367327820182]]}","name":"Path 4.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.75756065232,49.1273318448078],[-114.756509263768,49.1277777869136],[-114.756026028117,49.128007001132],[-114.755072041127,49.1281200006845],[-114.753491881977,49.1287263032413],[-114.753037222601,49.1289007457299],[-114.751817914843,49.1293859236228],[-114.750321231218,49.1300750482954],[-114.749435676249,49.1304960746273],[-114.748045046665,49.1311571968824],[-114.746314951831,49.132110896028]]}","name":"Path 5.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.753061627005,49.1255408107728],[-114.749218368405,49.1255323748947],[-114.748535211698,49.1256671369078],[-114.745488491373,49.1262680555334],[-114.742018823931,49.1278758067255],[-114.741533838915,49.1281005213734],[-114.739112835724,49.129041980349],[-114.736841191439,49.1299300498442]]}","name":"Path 6.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.749056147027,49.1163659811126],[-114.747014935279,49.1171371930521],[-114.746403593399,49.1173610098927],[-114.744096178562,49.1182057150665],[-114.740172074934,49.1192854936202]]}","name":"Path 7.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.719952197967,49.0892826451818],[-114.718298664857,49.090664037895],[-114.717401310466,49.0914136593303],[-114.715662700487,49.0930270337065],[-114.713799066058,49.0948779073285],[-114.712175794079,49.0965022009092],[-114.711277853923,49.09747468467],[-114.710625406621,49.0981812690836]]}","name":"Path 8.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.726084274128,49.0936241379611],[-114.725628618269,49.0944817107262],[-114.724663318136,49.0950968266274],[-114.724040737314,49.095493545808],[-114.722658375472,49.0958410918077],[-114.72063954357,49.096394901023],[-114.720540783758,49.0964219839113],[-114.717920572292,49.0970885400341],[-114.71561004502,49.0978090163822]]}","name":"Path 9.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.760984403374,49.2000884186456],[-114.76399455714,49.2002127118588],[-114.768159234234,49.2004486334857],[-114.769166547019,49.2005319354105],[-114.771787880189,49.200748687209],[-114.774466582196,49.2010529951558],[-114.775572654954,49.2011786257766]]}","name":"Path 10.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.759015146217,49.2013584199214],[-114.763508981143,49.2015496903943],[-114.766988816554,49.201453112364],[-114.768907870308,49.2014891165434],[-114.769422900933,49.2014828777689],[-114.771785225512,49.2014541976956],[-114.773895328717,49.2015209606924],[-114.775247473619,49.2015637160189]]}","name":"Path 11.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.753471387262,49.2039214280067],[-114.756877992499,49.2032716457582],[-114.756921028494,49.2032677853066],[-114.758365781809,49.2034264725677],[-114.759823262547,49.2038503592505],[-114.761873496748,49.2052554760698],[-114.763038729463,49.2058928441243],[-114.763466213143,49.2061266671207],[-114.766970255129,49.2072146866055],[-114.767064206673,49.2072438628601]]}","name":"Path 12.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.755827971339,49.2017072672141],[-114.758356238254,49.1993222702392],[-114.758667022849,49.1989112184523],[-114.759550210621,49.1977430334981],[-114.76040035603,49.1957293804625],[-114.760602861612,49.1952496944711],[-114.760967614916,49.1934996567424]]}","name":"Path 13.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.752441359695,49.2040118806089],[-114.752246959484,49.2025054186444],[-114.751668811394,49.2008963792742],[-114.751371923475,49.2001893816567],[-114.751255501636,49.1999121400147],[-114.750315301555,49.1986827797281],[-114.74938206466,49.1976089029774]]}","name":"Path 14.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.690968535459,49.1875263447927],[-114.689401886488,49.1852096487131],[-114.689289572483,49.1850630457821],[-114.688494283171,49.1840248521623],[-114.68796823321,49.1826446383735],[-114.687919771941,49.1817412003089],[-114.68787914988,49.1809840102068]]}","name":"Path 15.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.677277031885,49.1850123193938],[-114.675807596577,49.1825796982259],[-114.674503893474,49.1798679712467],[-114.674307946444,49.1785882081329],[-114.673954149909,49.1774571354396],[-114.673862868346,49.1772639219479],[-114.673596629528,49.176700285537],[-114.672709288707,49.1758336268805],[-114.67181881476,49.17496386138]]}","name":"Path 16.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.672619526624,49.1848255486186],[-114.669143393826,49.1824745548431],[-114.667798030853,49.1814205306605],[-114.667665604754,49.181332723405],[-114.666070276216,49.1802747668831],[-114.665449204226,49.1796852236638],[-114.664266037044,49.1785853285701],[-114.664261068653,49.1785806984233],[-114.663507352226,49.1775728365157],[-114.662887253363,49.1767186463501]]}","name":"Path 17.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.659080555449,49.1694599414918],[-114.657922385666,49.1709696671142],[-114.657181129994,49.1720172353651],[-114.656482282598,49.1728659730506],[-114.655871727577,49.1736074652694],[-114.654204179361,49.1750444233592]]}","name":"Path 18.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.657777512173,49.168754159015],[-114.655520593831,49.1695893067973],[-114.654108003752,49.1700886641041],[-114.653546059352,49.1706027901206],[-114.652571525666,49.1713209497227],[-114.652521737468,49.1713542117644],[-114.6517572441,49.1718650222225],[-114.650574611222,49.1727182375713],[-114.650213153299,49.1729603052338]]}","name":"Path 19.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.655893310056,49.1675078252154],[-114.654128453082,49.1685872755022],[-114.652884440013,49.1695086185823],[-114.651645369011,49.1704969564173],[-114.650963775007,49.1709863605956],[-114.650409465698,49.1713843457308],[-114.649389120544,49.1718302439733]]}","name":"Path 20.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.654131164666,49.1668738179119],[-114.651478986252,49.1669632898635],[-114.649807928845,49.167519459616],[-114.648621203557,49.1680247764217],[-114.647702497359,49.1685616151806],[-114.64754395988,49.1686860240821],[-114.646363697665,49.1696121577142]]}","name":"Path 21.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.648699321652,49.1627760766181],[-114.646909657613,49.1630571699604],[-114.645302435114,49.163478314693],[-114.643685192325,49.1640389687933],[-114.642117474307,49.1646104132026],[-114.641290833729,49.1649117160906],[-114.641022052465,49.1650096834184]]}","name":"Path 22.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.742030085681,49.1848470677344],[-114.740668954627,49.1852239824027],[-114.740047389035,49.1852601451088],[-114.739165579723,49.1854041276898],[-114.738638681538,49.1854901501746]]}","name":"Path 24.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.952750082623,49.3050063644235],[-114.946220205446,49.3044605133295],[-114.942449803263,49.3033767103833]]}","name":"Path 25.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.951740681045,49.3027197070421],[-114.946938830439,49.3015402188149],[-114.945319933046,49.3006272863884],[-114.945176990551,49.3005466668872]]}","name":"Path 26.0"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.831398075147,49.2243688138351],[-114.833850047549,49.2233469060751],[-114.835591025406,49.2216974448474],[-114.837723889483,49.2194714967966],[-114.838937643326,49.218464587517],[-114.839889312742,49.2175263801446],[-114.841156203398,49.2165981063849]]}","name":"Path 23.1"},
      {"st_asgeojson":"{\"type\":\"LineString\",\"coordinates\":[[-114.780059278404,49.1738215246141],[-114.785962693633,49.171157152781]]}","name":"Untitled Path"},
    ]
    
    fixed_test_paths = geomify(test_paths);
  }
*/
